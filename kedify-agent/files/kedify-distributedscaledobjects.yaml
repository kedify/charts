---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: distributedscaledobjects.keda.kedify.io
spec:
  group: keda.kedify.io
  names:
    kind: DistributedScaledObject
    listKind: DistributedScaledObjectList
    plural: distributedscaledobjects
    shortNames:
    - dso
    singular: distributedscaledobject
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Replicas Status - Current/Desired
      jsonPath: .status.print.totalReplicas
      name: TotalReplicas
      type: string
    - description: Member Clusters Status - Healthy/Total
      jsonPath: .status.print.membersCount
      name: Members
      type: string
    - description: Ready Status
      jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - description: Active Status from ScaledObject
      jsonPath: .status.conditions[?(@.type=="ScaledObjectActive")].status
      name: Active
      type: string
    - description: Age
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: DistributedScaledObject is the Schema for the DistributedScaledObject
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: DistributedScaledObjectSpec defines the desired state of
              DistributedScaledObject
            properties:
              memberClusters:
                description: |-
                  MemberClusters is the list of member clusters where the ScaledObject should trigger scaling of the target workloads
                  if empty, use all available member clusters
                items:
                  description: MemberCluster represents a member cluster where the
                    ScaledObject should be applied
                  properties:
                    name:
                      description: Name is the name of the member cluster
                      type: string
                    targetNamespace:
                      description: |-
                        TargetNamespace is the namespace in the member cluster where the scaling should be applied
                        defaults to the namespace of the DistributedScaledObject if not specified
                      type: string
                    weight:
                      default: 1
                      description: Weight is the weight of the member cluster for
                        scaling distribution
                      format: int32
                      type: integer
                  required:
                  - name
                  - weight
                  type: object
                type: array
              rebalancingPolicy:
                default:
                  gracePeriod: 1m
                  maxRebalancePercentage: 50
                description: RebalancingPolicy controls how the controller should
                  behave when clusters fail
                properties:
                  gracePeriod:
                    default: 1m
                    description: FailureGracePeriod is the duration to wait before
                      rebalancing the replicas when a member cluster becomes unhealthy
                    type: string
                  maxRebalancePercentage:
                    default: 50
                    description: MaxRebalancePercentage is the maximum percentage
                      of replicas that can be rebalanced at once
                    format: int32
                    type: integer
                required:
                - gracePeriod
                - maxRebalancePercentage
                type: object
              scaledObjectSpec:
                description: ScaledObjectSpec is the specification of the KEDA ScaledObject
                properties:
                  advanced:
                    description: AdvancedConfig specifies advance scaling options
                    properties:
                      horizontalPodAutoscalerConfig:
                        description: HorizontalPodAutoscalerConfig specifies horizontal
                          scale config
                        properties:
                          behavior:
                            description: |-
                              HorizontalPodAutoscalerBehavior configures the scaling behavior of the target
                              in both Up and Down directions (scaleUp and scaleDown fields respectively).
                            properties:
                              scaleDown:
                                description: |-
                                  scaleDown is scaling policy for scaling Down.
                                  If not set, the default value is to allow to scale down to minReplicas pods, with a
                                  300 second stabilization window (i.e., the highest recommendation for
                                  the last 300sec is used).
                                properties:
                                  policies:
                                    description: |-
                                      policies is a list of potential scaling polices which can be used during scaling.
                                      If not set, use the default values:
                                      - For scale up: allow doubling the number of pods, or an absolute change of 4 pods in a 15s window.
                                      - For scale down: allow all pods to be removed in a 15s window.
                                    items:
                                      description: HPAScalingPolicy is a single policy
                                        which must hold true for a specified past
                                        interval.
                                      properties:
                                        periodSeconds:
                                          description: |-
                                            periodSeconds specifies the window of time for which the policy should hold true.
                                            PeriodSeconds must be greater than zero and less than or equal to 1800 (30 min).
                                          format: int32
                                          type: integer
                                        type:
                                          description: type is used to specify the
                                            scaling policy.
                                          type: string
                                        value:
                                          description: |-
                                            value contains the amount of change which is permitted by the policy.
                                            It must be greater than zero
                                          format: int32
                                          type: integer
                                      required:
                                      - periodSeconds
                                      - type
                                      - value
                                      type: object
                                    type: array
                                    x-kubernetes-list-type: atomic
                                  selectPolicy:
                                    description: |-
                                      selectPolicy is used to specify which policy should be used.
                                      If not set, the default value Max is used.
                                    type: string
                                  stabilizationWindowSeconds:
                                    description: |-
                                      stabilizationWindowSeconds is the number of seconds for which past recommendations should be
                                      considered while scaling up or scaling down.
                                      StabilizationWindowSeconds must be greater than or equal to zero and less than or equal to 3600 (one hour).
                                      If not set, use the default values:
                                      - For scale up: 0 (i.e. no stabilization is done).
                                      - For scale down: 300 (i.e. the stabilization window is 300 seconds long).
                                    format: int32
                                    type: integer
                                  tolerance:
                                    anyOf:
                                    - type: integer
                                    - type: string
                                    description: |-
                                      tolerance is the tolerance on the ratio between the current and desired
                                      metric value under which no updates are made to the desired number of
                                      replicas (e.g. 0.01 for 1%). Must be greater than or equal to zero. If not
                                      set, the default cluster-wide tolerance is applied (by default 10%).

                                      For example, if autoscaling is configured with a memory consumption target of 100Mi,
                                      and scale-down and scale-up tolerances of 5% and 1% respectively, scaling will be
                                      triggered when the actual consumption falls below 95Mi or exceeds 101Mi.

                                      This is an alpha field and requires enabling the HPAConfigurableTolerance
                                      feature gate.
                                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                    x-kubernetes-int-or-string: true
                                type: object
                              scaleUp:
                                description: |-
                                  scaleUp is scaling policy for scaling Up.
                                  If not set, the default value is the higher of:
                                    * increase no more than 4 pods per 60 seconds
                                    * double the number of pods per 60 seconds
                                  No stabilization is used.
                                properties:
                                  policies:
                                    description: |-
                                      policies is a list of potential scaling polices which can be used during scaling.
                                      If not set, use the default values:
                                      - For scale up: allow doubling the number of pods, or an absolute change of 4 pods in a 15s window.
                                      - For scale down: allow all pods to be removed in a 15s window.
                                    items:
                                      description: HPAScalingPolicy is a single policy
                                        which must hold true for a specified past
                                        interval.
                                      properties:
                                        periodSeconds:
                                          description: |-
                                            periodSeconds specifies the window of time for which the policy should hold true.
                                            PeriodSeconds must be greater than zero and less than or equal to 1800 (30 min).
                                          format: int32
                                          type: integer
                                        type:
                                          description: type is used to specify the
                                            scaling policy.
                                          type: string
                                        value:
                                          description: |-
                                            value contains the amount of change which is permitted by the policy.
                                            It must be greater than zero
                                          format: int32
                                          type: integer
                                      required:
                                      - periodSeconds
                                      - type
                                      - value
                                      type: object
                                    type: array
                                    x-kubernetes-list-type: atomic
                                  selectPolicy:
                                    description: |-
                                      selectPolicy is used to specify which policy should be used.
                                      If not set, the default value Max is used.
                                    type: string
                                  stabilizationWindowSeconds:
                                    description: |-
                                      stabilizationWindowSeconds is the number of seconds for which past recommendations should be
                                      considered while scaling up or scaling down.
                                      StabilizationWindowSeconds must be greater than or equal to zero and less than or equal to 3600 (one hour).
                                      If not set, use the default values:
                                      - For scale up: 0 (i.e. no stabilization is done).
                                      - For scale down: 300 (i.e. the stabilization window is 300 seconds long).
                                    format: int32
                                    type: integer
                                  tolerance:
                                    anyOf:
                                    - type: integer
                                    - type: string
                                    description: |-
                                      tolerance is the tolerance on the ratio between the current and desired
                                      metric value under which no updates are made to the desired number of
                                      replicas (e.g. 0.01 for 1%). Must be greater than or equal to zero. If not
                                      set, the default cluster-wide tolerance is applied (by default 10%).

                                      For example, if autoscaling is configured with a memory consumption target of 100Mi,
                                      and scale-down and scale-up tolerances of 5% and 1% respectively, scaling will be
                                      triggered when the actual consumption falls below 95Mi or exceeds 101Mi.

                                      This is an alpha field and requires enabling the HPAConfigurableTolerance
                                      feature gate.
                                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                    x-kubernetes-int-or-string: true
                                type: object
                            type: object
                          name:
                            type: string
                        type: object
                      restoreToOriginalReplicaCount:
                        type: boolean
                      scalingModifiers:
                        description: ScalingModifiers describes advanced scaling logic
                          options like formula
                        properties:
                          activationTarget:
                            type: string
                          formula:
                            type: string
                          metricType:
                            description: |-
                              MetricTargetType specifies the type of metric being targeted, and should be either
                              "Value", "AverageValue", or "Utilization"
                            enum:
                            - AverageValue
                            - Value
                            type: string
                          target:
                            type: string
                        type: object
                    type: object
                  cooldownPeriod:
                    format: int32
                    type: integer
                  fallback:
                    description: Fallback is the spec for fallback options
                    properties:
                      behavior:
                        default: static
                        enum:
                        - static
                        - currentReplicas
                        - currentReplicasIfHigher
                        - currentReplicasIfLower
                        type: string
                      failureThreshold:
                        format: int32
                        type: integer
                      replicas:
                        format: int32
                        type: integer
                    required:
                    - failureThreshold
                    - replicas
                    type: object
                  idleReplicaCount:
                    format: int32
                    type: integer
                  initialCooldownPeriod:
                    format: int32
                    type: integer
                  maxReplicaCount:
                    format: int32
                    type: integer
                  minReplicaCount:
                    format: int32
                    type: integer
                  pollingInterval:
                    format: int32
                    type: integer
                  scaleTargetRef:
                    description: ScaleTarget holds the reference to the scale target
                      Object
                    properties:
                      apiVersion:
                        type: string
                      envSourceContainerName:
                        type: string
                      kind:
                        type: string
                      name:
                        type: string
                    required:
                    - name
                    type: object
                  triggers:
                    items:
                      description: ScaleTriggers reference the scaler that will be
                        used
                      properties:
                        authenticationRef:
                          description: |-
                            AuthenticationRef points to the TriggerAuthentication or ClusterTriggerAuthentication object that
                            is used to authenticate the scaler with the environment
                          properties:
                            kind:
                              description: Kind of the resource being referred to.
                                Defaults to TriggerAuthentication.
                              type: string
                            name:
                              type: string
                          required:
                          - name
                          type: object
                        metadata:
                          additionalProperties:
                            type: string
                          type: object
                        metricType:
                          description: |-
                            MetricTargetType specifies the type of metric being targeted, and should be either
                            "Value", "AverageValue", or "Utilization"
                          type: string
                        name:
                          type: string
                        type:
                          type: string
                        useCachedMetrics:
                          type: boolean
                      required:
                      - metadata
                      - type
                      type: object
                    type: array
                required:
                - scaleTargetRef
                - triggers
                type: object
              totalTargetReplicas:
                default: 0
                description: TotalTargetReplicas is the desired number of replicas
                format: int32
                type: integer
            required:
            - rebalancingPolicy
            - scaledObjectSpec
            type: object
          status:
            description: DistributedScaledObjectStatus defines the observed state
              of DistributedScaledObject
            properties:
              conditions:
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              memberClusterStatuses:
                additionalProperties:
                  description: MemberClusterStatus represents the status of a member
                    cluster
                  properties:
                    currentReplicas:
                      description: CurrentReplicas is the current number of replicas
                        in the member cluster
                      format: int32
                      type: integer
                    description:
                      description: Description provides additional information about
                        the member cluster status
                      type: string
                    desiredReplicas:
                      description: DesiredReplicas is the desired number of replicas
                        in the member cluster
                      format: int32
                      type: integer
                    excluded:
                      description: |-
                        Excluded indicates whether the member cluster is excluded from scaling
                        for example, due to being unhealthy for longer than the grace period
                      type: boolean
                    id:
                      description: ID is the identification of the member cluster
                        for multicluster-controller
                      type: string
                    lastScalingProgressTime:
                      description: |-
                        LastScalingProgressTime is the last time the scaling made progress
                        This is used to determine how long the member cluster has been making slow progress for rebalancing purposes
                      format: date-time
                      type: string
                    lastStatusChangeTime:
                      description: |-
                        LastStatusChangeTime is the last time the status changed
                        This is used to determine how long the member cluster has been unhealthy for rebalancing purposes
                      format: date-time
                      type: string
                    state:
                      description: State is the state of the member cluster (e.g.,
                        Ready, NotReady)
                      type: string
                  required:
                  - currentReplicas
                  - description
                  - desiredReplicas
                  - id
                  - state
                  type: object
                description: MemberClusterStatuses represents the status of each member
                  cluster
                type: object
              membersHealthyCount:
                description: MembersHealthyCount is the number of healthy member clusters
                format: int32
                type: integer
              membersTotalCount:
                description: MembersTotalCount is the total number of member clusters
                format: int32
                type: integer
              print:
                description: Print is used for custom printing of DistributedScaledObject
                  status
                properties:
                  membersCount:
                    description: MembersCountStatus is the status of member clusters
                    type: string
                  totalReplicas:
                    description: TotalReplicas represents the status of replicas across
                      member clusters
                    type: string
                type: object
              selector:
                description: Selector is the selector for HPA
                type: string
              totalCurrentReplicas:
                description: TotalCurrentReplicas is the current number of replicas
                format: int32
                type: integer
            required:
            - selector
            - totalCurrentReplicas
            type: object
        type: object
    served: true
    storage: true
    subresources:
      scale:
        labelSelectorPath: .status.selector
        specReplicasPath: .spec.totalTargetReplicas
        statusReplicasPath: .status.totalCurrentReplicas
      status: {}
